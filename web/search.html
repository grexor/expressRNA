<link rel="stylesheet" href="/tippy/tippy.css">
<script src="/tippy/tippy.min.js"></script>
<style>
.tippy-tooltip.light-theme {
  font-family: 'Roboto', sans-serif;
  font-size: 13px;
  font-weight: 300;
  text-align: justify;
  background-color: #ffffff !important;
}

.search {
    border: 0.8px solid #c1c1c1;
    padding: 2px;
    padding-left: 4px;
    border-radius:5px;
    -moz-border-radius:5px;
    -webkit-border-radius:5px;
    outline: none;
    font-size: 12px;
    color: #555555;
    display: none;
 }

</style>

<script>
  menu_select("link_search");
</script>

<div class="main">
    <div class="main_content">
    <table border=0>
      <tr>
        <td valign=top>
          <div id=div_analysis class="title_font_selected" align=right style="float:left; padding-right:10px; padding-bottom:10px;"><a href="javascript:search_analysis();" class='title_link'><img id="icon_analysis" src=media/comparisons.png height=18 style="margin-top:-2px;vertical-align:middle;padding-left: 5px; padding-right: 5px;">Analysis</a></div>
          <div id=div_libraries class="title_font" align=right style="float: left; padding-right:10px; padding-bottom:10px;"><a href="javascript:search_libraries();" class='title_link'><img id="icon_library" src=media/library.png height=18 style="margin-top:-2px;vertical-align:middle;padding-left: 5px; padding-right: 5px;">Libraries</a></div>
        </td>
      </tr>
      <tr>
        <td class="content_table" valign=top>
          <div id="div_search_analysis"><form><input id="lbl_search_analysis" type="text" placeholder="Search" class="search" onkeyup="search_analysis();"></form></div>
          <div id="div_search_libraries"><form><input id="lbl_search_libraries" type="text" placeholder="Search" class="search" onkeyup="search_libraries();"></form></div>
          <div id="tbl_comps"></div>
          <div id="lbl_count" style="padding-top: 10px; font-size: 11px; text-align: right; widht: 100%"></div>
        </td>
      </tr>
    </table>
</div>

<script>

function search_analysis() {
  $("#lbl_search_analysis").show();
  $("#lbl_search_libraries").hide();
  lbl_search = $("#lbl_search_analysis").val();
  add_history("search", {"section":"analysis"}, 'index.html?action=search&section=analysis');
  clear_selection();
  $("#icon_analysis").attr("src", "media/comparisons.png");
  $("#div_analysis").attr("class", "title_font_selected");
  post_data = {};
  post_data["action"] = "list_analysis";
  post_data["email"] = email;
  post_data["session"] = session;
  post_data["search"] = lbl_search;
  $.post('/expressrna_gw/index.py', post_data)
      .success(function(result) {
          data = $.parseJSON(result);
          display_analysis(data);
      })
      .error(function(){
  })
}

function search_libraries() {
  $("#lbl_search_libraries").show();
  $("#lbl_search_analysis").hide();
  lbl_search = $("#lbl_search_libraries").val();
  add_history("search", {"section":"libraries"}, 'index.html?action=search&section=libraries');
  clear_selection();
  $("#icon_library").attr("src", "media/library.png");
  $("#div_libraries").attr("class", "title_font_selected");
  post_data = {};
  post_data["action"] = "list_libraries";
  post_data["search"] = lbl_search;
  post_data["email"] = email;
  post_data["session"] = session;
  $.post('/expressrna_gw/index.py', post_data)
      .success(function(result) {
          data = $.parseJSON(result);
          display_libraries(data);
      })
      .error(function(){
  })
}

function sort_data(list, key) {
    function compare(a, b) {
        a = a[key];
        b = b[key];
        var type = (typeof(a) === 'string' ||
                    typeof(b) === 'string') ? 'string' : 'number';
        var result;
        if (type === 'string') result = a.localeCompare(b);
        else result = a - b;
        return result;
    }
    return list.sort(compare);
}

function display_analysis(data) {
  lbl_search = $("#lbl_search").val();
  data = sort_data(data, "authors");
  html = "Search and browse alternative polyadenylation and other analysis.<br><br>"
  html += "<table class='comps_table'><tr style='background-color: #f1f1f1; vertical-align: top'>";

  help_type = "Analysis type: currently, the only analysis type included in online browsing is APA (alternative polyadenylation).";
  help_status = "Status of the analysis:<br><br>Complete: analysis is complete and ready for exploration<br><font color=green>Processing</font>: analysis is currently processing<br><font color=red>Queued</font>: analysis is queued for processing<br><br>Queued analysis start processing when resources are available.";

  html += "<td style='padding-top: 3px; padding-bottom: 3px; min-width: 200px;'><font color=gray><b>Name</b></font></td>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><font color=gray><b>Notes</b></font>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px; min-width: 100px;'><font color=gray><b>Authors</b></font>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><b><font color=gray>Type</font></b>&nbsp;<font class='btn' title='" + help_type + "'><img src=media/help.png style='height: 15px; margin-top:-2px;vertical-align:middle; padding-left: 3px;'></font></b></font></td>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><font color=gray><b>Status</b></font>&nbsp;<font class='btn' title='" + help_status + "'><img src=media/help.png style='height: 15px; margin-top:-2px;vertical-align:middle; padding-left: 3px;'></font></td>";
  html += "</tr>";

  for (var i=0; i<Math.min(data.length, 100); i++) {
      comps_id = data[i].comps_id;
      comps_name = data[i].comps_name;
      comps_notes = data[i].notes;
      comps_authors = data[i].authors;
      comps_name_search = data[i].comps_name_search;
      comps_notes_search = data[i].notes_search;
      comps_authors_search = data[i].authors_search;
      html += "<tr>";
      html += "<td><a href=\"javascript:open_analysis('" + comps_id + "', '" + comps_name + "');\">" + comps_name_search + "</a></td>";
      html += "<td class='notes'>" + comps_notes_search + "</td>";
      html += "<td class='notes'>" + comps_authors_search.split(",").join("<br>") + "</td>";
      html += "<td align=center style='vertical-align: middle'><img src=media/alt.png height=30 style='padding-right:0px; margin-top:-5px;vertical-align:middle'></td>";
      html += "<td class='last_change' style='vertical-align: middle'>" + "<font color=gray>Complete</font>" + "</td>";
      html += "</tr>";
  }

  html += "</table>";
  $("#tbl_comps").html(html);
  $("#lbl_count").html("Displaying " + Math.min(data.length, 100) + " of " + data.length + " analysis");
  tippy('.btn', {theme: 'light', interactive: true});
}

function display_libraries(data) {
  help_identifier = "Name of the library, usually simply a date_name identifier which uniquelly locates the data in expressRNA. You can explore (view) the library contents by clicking on this link."
  help_type = "Library type: currently supported sequencing protocols include:<br><br>Lexogen Quantseq Forward<br>Lexogen Quantset Reverse<br>Nanopore<br>Illumina RNA-seq<br><br>Other sequencing data can be added on request.";

  html = "Search and browse your libraries and other published datasets.<br><br>";
  html += "<table class='comps_table'><tr style='background-color: #f1f1f1; vertical-align: top'>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><font color=gray><b>Name</b></font>&nbsp;<font class='btn' title='" + help_identifier + "'><img src=media/help.png style='height: 15px; margin-top:-2px;vertical-align:middle; padding-left: 3px;'></font></td>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><font color=gray><b>Short description</b></font></td>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><font color=gray><b>Notes</b></font></td>";
  html += "<td style='padding-top: 3px; padding-bottom: 3px;'><b><font color=gray>Type</font></b>&nbsp;<font class='btn' title='" + help_type + "'><img src=media/help.png style='height: 15px; margin-top:-2px;vertical-align:middle; padding-left: 3px;'></font></b></font></td>";
  html += "</tr>";

  for (var i=0; i<Math.min(100, data.length); i++) {
      lib_id = data[i].lib_id;
      lib_id_search = data[i].lib_id_search;
      name = data[i].name;
      name_search = data[i].name_search;
      notes = data[i].notes;
      notes_search = data[i].notes_search;
      method = data[i].method;
      method = data[i].method_search;
      html += "<tr>";
      html += "<td><a href=\"javascript:open_library('" + lib_id + "');\">" + lib_id_search + "</a></td>";
      html += "<td>" + name_search + "</td>";
      html += "<td class='notes'>" + notes_search + "</td>";
      html += "<td class=nowrap align=left style='vertical-align: middle'>" + methods_dic[data[i].method] + "</td>";
      html += "</tr>";
  }
  html += "</table>";

  $("#tbl_comps").html(html);
  $("#lbl_count").html("Displaying " + Math.min(data.length, 100) + " of " + data.length + " libraries");
  tippy('.btn', {theme: 'light', interactive: true});
}

function clear_selection() {
  $("#icon_analysis").attr("src", "media/comparisons.png");
  $("#icon_library").attr("src", "media/library.png");
  $("#div_analysis").attr("class", "title_font");
  $("#div_libraries").attr("class", "title_font");
}

</script>

<script>

  function open_section() {
    if (pars["section"]=="analysis") {
      search_analysis();
    }
    if (pars["section"]=="libraries") {
      search_libraries();
    }
  }

  open_section();
  tippy('.btn', {theme: 'light', interactive: true});
</script>
